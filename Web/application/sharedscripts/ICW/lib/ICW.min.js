(function () {

    var getLogger = function (loggerName) {

        var logger = null;

        if (window.ICWGetLogger) {
            logger = window.ICWGetLogger(loggerName);
        } else {
            logger = {
                trace: function () {
                },
                debug: function () {
                },
                info: function () {
                },
                warn: function () {
                },
                error: function () {
                },
                fatal: function () {
                }
            };
        };

        return logger;
    };

    var logger = getLogger(window.location + "-ICW.min.js");

    logger.debug("Library Started loading");

    function GetWebSiteAddressFromScriptTagWhichLoadedThisScript() {
        var scripts = document.getElementsByTagName('script');
        var path = "";
        var mydir = "";

        for (var i = scripts.length - 1; i >= 0; i--) {
            var scriptPath = scripts[i].src;
            if (scriptPath.length > 0) {
                path = scriptPath.split('?')[0]; // remove any ?query
            }
        }

        if (path.indexOf("http://") != -1) {
            mydir = path.split('/').slice(0, -1).join('/') + '/'; // remove last filename part of path
        }

        return mydir;
    }

    var mydir = GetWebSiteAddressFromScriptTagWhichLoadedThisScript();

    var loadJS = function (file) {
        var script = document.createElement('script');
        script.src = file;
        script.type = 'text/javascript';
        document.getElementsByTagName('head')[0].appendChild(script);
    };

    var loadRelativeToWebsiteRootJS = function (jsFileLocationRelativeToWebsiteRoot, hasJsLoaded, nextScriptToLoad) {

        var loadNextScript = function () {
            if (nextScriptToLoad) {
                if (hasJsLoaded()) {
                    nextScriptToLoad();
                } else {
                    window.setTimeout(loadNextScript, 10);
                }
            }
        };

        var load = function () {

            if (hasJsLoaded()) {
                loadNextScript();
                return;
            }

            for (var i = 0; i < 5 && !hasJsLoaded(); i++) {
                loadJS(mydir + jsFileLocationRelativeToWebsiteRoot);

                jsFileLocationRelativeToWebsiteRoot = "../" + jsFileLocationRelativeToWebsiteRoot;
            };

            loadNextScript();
        };

        load();
    }

    try {
        //JSON functionality is integrated into IE8+ this script provides for IE7
        loadRelativeToWebsiteRootJS("application/sharedscripts/lib/json2.js?v=00.00.00.00", function () { return window.JSON != undefined; }, function () {

            loadRelativeToWebsiteRootJS("application/sharedscripts/ICW/lib/log4javascript.ashx?v=00.00.00.00", function () { return window.log4javascript_disabled != undefined; }, function () {

                loadRelativeToWebsiteRootJS("application/sharedscripts/ICW/lib/ICW.lib.js?v=00.00.00.00", function () { return window.ICW != undefined && window.ICW.util != undefined; }, function () {

                    loadRelativeToWebsiteRootJS("application/sharedscripts/ICW/lib/ICW.noEvents.js?v=00.00.00.00", function () { return window.ICW != undefined && window.ICW.noEvents != undefined; });

                    loadRelativeToWebsiteRootJS("application/sharedscripts/ICW/lib/ICW.HtmlFixes.js?v=00.00.00.00", function () { return window.ICW != undefined && window.ICW.HtmlFixes != undefined; });

                });
            });
        });
    } catch (ex) {
    }

    logger.debug("Finished Loading");

    if (window.ICW == undefined) {
        window.ICW = {};
    }

    window.ICW.MIN = {
        GetLogger: getLogger
    };

})();